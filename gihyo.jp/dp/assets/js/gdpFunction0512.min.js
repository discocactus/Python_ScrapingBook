(function(){var action,api,apiUrl,appendHTML,auth,banner,baseUrl,bookSearch,cart,data_of,dialog,doc,dropmenu,e,eventhandle,first_child,getWindowSize,header,is_all_ws,is_ignorable,j,last_child,lazy,len,main,mkElm,n,navigation,node_after,node_before,notify,overlay,page,posOffset,ready,ref,ref1,search,selectmenu,series,subscription,totalHeight,wait,win,windowHeight,wrapper;for(Date.now||(Date.now=function(){return(new Date).valueOf()}),baseUrl="/dp",apiUrl="/dp/api/v2/",win=window,doc=document,main=doc.getElementById("main"),header=doc.getElementById("header"),navigation=doc.getElementById("navigation"),ref=doc.querySelectorAll("noscript"),j=0,len=ref.length;len>j;j++)n=ref[j],n.parentNode.removeChild(n);if(n=void 0,posOffset=function(el){var rect,x,y;return rect=el.getBoundingClientRect(),el=void 0,y=win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0,x=win.pageXOffset||doc.documentElement.scrollLeft||doc.body.scrollLeft||0,{top:rect.top+y,left:rect.left+x,width:rect.width,height:rect.height}},mkElm=function(elm,id){var d;return d=doc.createElement(elm),d.id=id,d},appendHTML=function(elm,str){var as,df,e,f,h,i,len1,m,ns,s,sc,ss,st,t,tp,v;for(sc=[],i=0,s=str.indexOf("<script"),e=str.indexOf("</script>");s>=0&&e>=0;)e+=9,h=str.substring(0,s),sc[i]=str.substring(s,e),f=str.substring(e),str=h+'<span id="scghidx'+i+'"></span>'+f,i++,s=str.indexOf("<script"),e=str.indexOf("</script>");for(f=doc.createDocumentFragment(),ns=f.appendChild(doc.createElement("div")),ns.innerHTML=str,i=m=0,len1=sc.length;len1>m;i=++m)v=sc[i],s=doc.createElement("script"),tp=/<script [^>]*type="([\s\S]+?)"/i.exec(v),ss=/<script [^>]*src="([\s\S]+?)"/i.exec(v),df=/<script [^>]*defer/i.exec(v),as=/<script [^>]*async/i.exec(v),st=/<script[^>]*>([\s\S]+?)<\/script>/i.exec(v),tp&&(s.type=tp[1]),df&&(s.defer=!0),as&&(s.async=!0),ss?s.src=ss[1]:s.text=st[1],t=ns.querySelector("#scghidx"+i),t.parentNode.replaceChild(s,t);for(;n=ns.firstChild;)ns.removeChild(n),n&&!is_ignorable(n)&&elm.appendChild(n);n=void 0,ns=void 0,s=void 0,f=void 0},totalHeight=0,windowHeight=0,getWindowSize=function(){totalHeight=win.innerHeight&&win.scrollMaxY?win.innerHeight+win.scrollMaxY:doc.body.scrollHeight>doc.body.offsetHeight?doc.body.scrollHeight:doc.body.offsetHeight,win.innerHeight?windowHeight=win.innerHeight:doc.documentElement&&doc.documentElement.clientHeight?windowHeight=doc.documentElement.clientHeight:doc.body&&(windowHeight=doc.body.clientHeight)},wait={tid:null,show:function(){var d;return params.noclick=!0,doc.getElementById("wait").classList.remove("hidden"),null==doc.getElementById("clickBlock")?(d=mkElm("div","clickBlock"),doc.body.insertBefore(d,doc.body.firstChild),d=void 0):void 0},hide:function(){var d;return d=doc.getElementById("clickBlock"),null!=d&&d.parentNode.removeChild(d),doc.getElementById("wait").classList.add("hidden"),params.noclick=!1,d=void 0}},lazy={ratio:1,images:{},cnt:0,show:function(){var ot,t,tgt;t=win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0,overlay.flag&&(tgt=doc.getElementById(doc.getElementById("overlayMain")?"overlayMain":"bookInforMain"),ot=tgt.scrollTop,this._show(ot),tgt=void 0),this._show(t)},_show:function(t){var key,o,p,src,tmp;for(key in this.images)p=this.images[key].y,p>=t-200&&t+windowHeight+100>=p&&(o=this.images[key].obj,tmp=o.getAttribute("data-image").split(","),src=tmp[0],this.ratio>1&&null!=tmp[1]&&(src=tmp[1]),o.removeAttribute("data-image"),o.removeAttribute("data-id"),o.setAttribute("src",src),this.images[key]=void 0,delete this.images[key]);o=void 0},init:function(){var len1,m,obj,ref1;for(null!=win.devicePixelRatio&&(this.ratio=win.devicePixelRatio),this.images={},this.cnt=0,ref1=doc.body.querySelectorAll("img[data-image]"),m=0,len1=ref1.length;len1>m;m++)obj=ref1[m],obj.setAttribute("data-id",lazy.cnt),lazy.images[lazy.cnt]={y:posOffset(obj).top,obj:obj},lazy.cnt++;obj=void 0},repos:function(){var key;for(key in this.images)this.images[key].y=posOffset(this.images[key].obj).top}},action={scrollTop:{n:0,obj:null,func:function(e,obj){"A"!==e.target.tagName&&(this.n=obj===win?win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0:obj.scrollTop,this.obj=obj,action.scrollTop["do"]()),obj=void 0,e=void 0},"do":function(){this.n>0?(this.n=this.n>.5?this.n/100*60:0,this.obj===win?this.obj.scrollTo(0,Math.round(this.n)):this.obj&&(this.obj.scrollTop=Math.round(this.n))):this.n=0,this.n>0?setTimeout(function(){return action.scrollTop["do"]()},20):(this.obj===win?this.obj.scrollTo(0,0):this.obj&&(this.obj.scrollTop=0),this.obj=null,this.n=null)}}},selectmenu={menu:null,init:function(){var d,label,obj,t;return this.menu=doc.getElementById("select"),this.menu&&(t=doc.getElementById("topNavigationTitle"),t&&t.parentNode.removeChild(t),t=void 0,obj=this.menu.querySelector(".selected a"))?(label=obj.innerHTML,doc.getElementById("selectLabel").innerHTML=label,"すべての"!==label.substring(0,4)&&(d=mkElm("h3","topNavigationTitle"),d.textContent="『"+label+"』の一覧",t=doc.getElementById("topNavigation"),t.parentNode.insertBefore(d,t.nextSibling),t=void 0,d=void 0),obj=void 0):void 0},disable:function(){return this.menu&&this.menu.classList.contains("pin")?this.menu.classList.remove("pin"):void 0},enable:function(){return this.menu.classList.contains("pin")?void 0:this.menu.classList.add("pin")}},series={init:function(){var h,s,t,tmp;return s="",s=/^\/dp\/series\/([^?]+)/.exec(overlay.flag?page.parentUrl:page.url),null!=s?(tmp=decodeURIComponent(s[1]),h=mkElm("h3","topNavigationTitle"),h.textContent=tmp+"一覧",t=doc.getElementById("topNavigation"),t.parentNode.insertBefore(h,t.nextSibling),h=void 0,t=void 0,selectmenu.disable()):void 0}},search={_kp:function(e){var k,w;return w=e.which,k=e.keyCode,e=void 0,w&&13===w||k&&13===k?(this.blur(),!1):void 0},_ch:function(e){return e.preventDefault(),e=void 0,search.action(),!1},init:function(){var obj;return(obj=doc.getElementById("searchText"))?(obj.addEventListener("keypress",this._kp),obj.addEventListener("change",this._ch),obj=void 0):void 0},action:function(){var d,g,i,q,reg,t,tmp,url,w;if(w=doc.getElementById("searchText").value,reg=new RegExp("^https?://"+location.hostname+"(:[0-9]+)?"),url=doc.getElementById("search").getAttribute("action").replace(reg,""),reg=void 0,g="",q="",selectmenu.menu&&(t=selectmenu.menu.querySelector(".selected a"),g=t.innerHTML,("すべての商品"===g||"すべての期間"===g||"すべての蔵書"===g)&&(g=""),tmp=t.getAttribute("href").replace(baseUrl,""),t=void 0,i=tmp,tmp.length&&(i=i.substring(1)),d=i.split("/"),g))switch(d[0]){case"":g="";break;case"genre":g="/genre/"+g;break;case"information":case"my-page":g="/"+g.slice(0,-1)}return w&&(q="?query="+encodeURIComponent(w)),page.push(url+g+q)}},bookSearch={code:0,_kp:function(e){var k,w;return w=e.which,k=e.keyCode,e=void 0,w&&13===w||k&&13===k?(this.blur(),!1):void 0},_ch:function(e){return e.preventDefault(),e=void 0,bookSearch.action(),!1},init:function(){var bsobj,obj;return bsobj=doc.getElementById("bookSearch"),bsobj&&(this.code=bsobj.querySelector("[name=code]").value,obj=doc.getElementById("bookSearchText"),obj.addEventListener("keypress",this._kp),obj.addEventListener("change",this._ch),obj=void 0),bsobj=void 0},action:function(){var w;return w=doc.getElementById("bookSearchText").value,api.success.bookSearch=function(json){var d,obj;return obj=doc.getElementById("bookSearch"),d=doc.getElementById("bsResult"),null!=d&&d.parentNode.removeChild(d),d=mkElm("div","bsResult"),d.innerHTML=json.list,obj.appendChild(d),d=void 0,obj=void 0},api.call("POST","bookSearch",{query:w,code:this.code},!0,!1)}},api={success:[],error:[],_q:function(k,v){var i,q,vv;if(q="","object"==typeof v)for(i in v)vv=v[i],q&&(q+="&"),q+=this._q(k+"["+i+"]",vv);else q=k+"="+encodeURIComponent(v);return q},call:function(type,func,data,sync,actime){var i,k,q,qs,v,xhr;null==data&&(data={}),null==sync&&(sync=!1),null==actime&&(actime=!0),data.isLogin=params.isLogin,actime&&(data.acTime=Date.now()),q="",qs="";for(i in data)v=data[i],k=encodeURIComponent(i),q&&(q+="&"),q+=this._q(k,v);return q?"GET"===type&&(qs="?"+q,q=null):q=null,xhr=new XMLHttpRequest,xhr.open(type,apiUrl+func+qs,sync),xhr.setRequestHeader("x-requested-with","XMLHttpRequest"),"POST"===type&&xhr.setRequestHeader("content-type","application/x-www-form-urlencoded; charset=UTF-8"),xhr.onreadystatechange=function(){var json,txt;4===xhr.readyState&&(xhr.status>=200&&xhr.status<400?(txt=xhr.responseText,json={},txt&&(json=JSON.parse(txt)),"function"==typeof api.success[func]&&api.success[func](json),api.success[func]=null,api.error[func]=null,xhr=void 0):("function"==typeof api.error[func]&&api.error[func](),api.success[func]=null,api.error[func]=null,xhr=void 0))},xhr.send(q)}},auth={tmperr:"",form:function(){var d,err,len1,m,obj,p,pass,ref1,ret,t,user;for(obj=doc.getElementById("gihyoAccount"),err="",user="",pass="",ref1=obj.querySelectorAll("dd > input"),m=0,len1=ref1.length;len1>m;m++)t=ref1[m],t.value||(err="ID・パスワードを入力してください"),"account"===t.name&&(user=t.value),"password"===t.name&&(pass=t.value);return t=void 0,""===err&&(wait.show(),this.login(user,pass)!==!0&&(err=this.tmperr),wait.hide()),ret=!0,""!==err?(ret=!1,p=doc.createElement("p"),p.textContent=err,d=mkElm("div","accountError"),d.appendChild(p),p=void 0,obj.appendChild(d),setTimeout(function(){return d.parentNode.removeChild(d),d=void 0},2500)):(dialog.disable(),d=void 0),obj=void 0,ret},logout:function(){api.error.logout=function(){return dialog.flag===!0?dialog.disable():overlay.flag===!0&&overlay.disable(!0),!1},api.success.logout=function(json){var a,d,p,ref1,tmp;return dialog.disable(),null!=(null!=(ref1=json.html)?ref1.menu:void 0)&&(a=doc.getElementById("account"),a&&a.parentNode.removeChild(a),d=doc.createElement("div"),d.innerHTML=json.html.menu,a=first_child(d),d=void 0,p=doc.getElementById("headerFunction"),p.insertBefore(a,p.firstChild),a=void 0,p=void 0),params.isLogin=!1,page.cache={},tmp=page.url,page.url="",page.load(tmp,!0,!1,!1),cart.pids=[],cart.nums={},cart.refresh()},api.call("GET","logout"),page.url===baseUrl+"/my-page"&&page.push(baseUrl)},login:function(user,pass){return api.error.login=function(){return dialog.flag===!0?dialog.disable():overlay.flag===!0&&overlay.disable(!0),!1},api.success.login=function(json){var d,h,l,ref1,ret,tmp;return ret=!1,null!=json.auth&&"200"===json.auth?(dialog.disable(),page.cache={},tmp=page.url,page.url="",page.load(tmp,!0,!1,!1),cart.refresh(),ret=!0,l=doc.getElementById("login"),l&&l.parentNode.removeChild(l),l=void 0,null!=(null!=(ref1=json.html)?ref1.menu:void 0)&&(d=doc.createElement("div"),appendHTML(d,json.html.menu),h=doc.getElementById("headerFunction"),h.insertBefore(first_child(d),h.firstChild),d=void 0,h=void 0)):auth.tmperr=json.error,params.isLogin=json.isLogin},api.call("POST","login",{user:user,password:pass}),params.isLogin}},page={mobile:!1,click:!0,flag:"",url:"",hash:"",parentUrl:"",body:"",cache:{},cacheLimit:0,hasScrolled:!1,scrollPos:0,posCache:{},touch:!1,mtid:null,message:function(mes){var d,l;return this.mtid&&(clearTimeout(this.mtid),l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),this.mtid=null),l=mkElm("div","loadingMessage"),l.innerHTML=mes,d=doc.getElementById("footer"),d.insertBefore(l,d.firstChild),l=void 0,d=void 0,this.mtid=setTimeout(function(){return l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),l=void 0},1e4)},loadFunc:function(json,push){var c,d,h,key,mflag,p,ref1,ref2,ref3,ref4,tgt;if(null==push&&(push=!0),json){if(mflag=!1,dialog.flag&&dialog["break"](),null!=json.isLogin&&params.isLogin!==json.isLogin&&(params.isLogin===!0?auth.logout():(page.cache={},params.isLogin=json.isLogin)),null!=json.pids&&(cart.pids=json.pids,cart.nums=json.nums||{},cart.setNum()),null!=json.current&&(doc.body.setAttribute("class",""),doc.body.classList.add("page-"+json.current)),(json.title||json.params.url||json.description||json.keyword||json.image)&&(h=doc.querySelector("head"),json.title&&(doc.title=json.title,h.querySelector('meta[property="og:title"]').setAttribute("content",json.title)),json.params.url&&h.querySelector('meta[property="og:url"]').setAttribute("content",json.params.url),json.description&&(h.querySelector('meta[property="og:description"]').setAttribute("content",json.description),h.querySelector('meta[name="description"]').setAttribute("content",json.description)),json.keyword&&h.querySelector('meta[name="keywords"]').setAttribute("content",json.keyword),json.image&&h.querySelector('meta[property="og:image"]').setAttribute("content",json.image),h=void 0),null!=json.params.free&&(cart.free=json.params.free),null!=(null!=(ref1=json.params)?ref1.overlay:void 0)&&json.params.overlay===!0)push&&this.parentUrl&&this.url!==this.parentUrl&&this.parentUrl&&overlay.urlStack.push(this.parentUrl),wrapper.flag!==!0&&wrapper.enable(),overlay.flag?(d=doc.createElement("div"),appendHTML(d,json.overlay),c=first_child(d),d=void 0,c.style.display="block",c.style.opacity=1,null!=(ref2=c.querySelector("#close"))&&(ref2.style.display="none"),p=doc.getElementById("overlayWindow"),p.parentNode.replaceChild(c,p),c=void 0,p=void 0):appendHTML(main,json.overlay),overlay.show();else if(overlay.flag===!0&&(overlay._break(!0),overlay.urlStack=[],wrapper.disable()),(overlay.flag===!1||""===page.body)&&json.body&&page.body!==json.body){switch(page.body=json.body,d=doc.createElement("div"),d.id="main",appendHTML(d,json.body),doc.body.replaceChild(d,main),d=void 0,main=doc.getElementById("main"),n=doc.getElementById("navigationLink"),null!=(ref3=n.querySelector(".current"))&&ref3.classList.remove("current"),null!=(ref4=n.querySelector(".new"))&&ref4.classList.remove("new"),n=void 0,tgt="Home",json.params.path.substr(0,8)){case baseUrl+"/my-p":tgt="MyPage";break;case baseUrl+"/info":tgt="Infor";break;case baseUrl+"/help":tgt="Help"}if(doc.getElementById("navLink"+tgt).classList.add("current"),null!=json["new"])for(tgt in json["new"])doc.getElementById(tgt).classList.add("new");mflag=!0}if(null!=json.params.dialog&&json.params.dialog===!0&&dialog.enable("message"),null!=json.params.forceLogin&&json.params.forceLogin===!0&&(null==params.forceLogin||params.forceLogin===!1)&&dialog.login.open(),null!=json.params.forceError&&json.params.forceError===!0&&setTimeout(function(){return dialog.error.open(json.params.error)},50),null!=json.parts)for(key in json.parts)doc.getElementById(key)&&(doc.getElementById(key).innerHTML=json.parts[key]);return getWindowSize(),lazy.init(),lazy.show(),selectmenu.init(),search.init(),null!=selectmenu.menu&&(selectmenu.menu.classList.add("anime"),doc.body.classList.contains("page-home")&&0===(win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0)&&((page.mobile||overlay.flag||dialog.flag)!==!0&&doc.getElementById("searchText").focus(),mflag&&page.url===baseUrl&&selectmenu.enable())),series.init(),doc.getElementById("bannerTopAd")&&banner.show(),null!=this.scrollPos&&win.scroll(0,this.scrollPos),this.headerset(),this.footerset()}},lfData:function(url,act,param,push,async){return null==act&&(act="get"),null==param&&(param=""),null==push&&(push=!1),null==async&&(async=!0),null!=this.cache[url]?(params.callBack(),null!=params.additionalCallBack&&(params.additionalCallBack(),params.additionalCallBack=null),push===!0&&(page.pushState(url),page.flag=location.href),doc.getElementById("bannerTopAd")&&banner.show(),!0):(wait.show(),api.success[act]=function(json){var l,now;return params.oldParent="",params.oldUrl="",now=Date.now(),page.cacheLimit<now-18e5&&(page.cache={},page.cacheLimit=now),page.cache[url+param]=json,wait.hide(),l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),l=void 0,params.callBack(),null!=params.additionalCallBack&&(params.additionalCallBack(),params.additionalCallBack=null),push===!0&&(page.pushState(url),page.flag=location.href),!0},api.error[act]=function(){return page.parentUrl=params.oldParent,page.url=params.oldUrl,params.oldParent="",params.oldUrl="",dialog.error.open(),!1},"function"===act&&(async=!1),void api.call("GET",act,{url:url,param:param},async,!1))},reload:function(){return this.cache[this.url]=null,wait.show(),params.callBack=function(){return page.loadFunc(page.cache[page.url],!1)},this.lfData(this.url)},load:function(url,parentSet,push,async){var reg;return null==parentSet&&(parentSet=!0),null==push&&(push=!1),null==async&&(async=!0),reg=new RegExp("^https?://"+location.hostname+"(:[0-9]+)?"),url=url.replace(reg,"").replace(/#.+?$/,""),reg=void 0,url!==this.url&&(params.oldParent=this.parentUrl,params.oldUrl=this.url,parentSet===!0&&(this.parentUrl=this.url),this.url=url,this.hash="",params.callBack=function(){return page.loadFunc(page.cache[url],push)},this.lfData(url,"get","",push,async)),push&&ga?ga("send","pageview",url):void 0},initsub:function(){var bgpage,o,pos,t;return params.giftChange=function(obj){var id,pid,ref1;return null==(null!=(ref1=obj.parentNode)?ref1.parentNode:void 0)?!1:(id=obj.parentNode.parentNode.id,pid=id.substring(3),void cart.cntset(pid,obj.value))},this.flag=location.href,"/"===params.path.substr(-1,1)&&(params.path=params.path.substr(0,-1)),this.url=params.path,this.hash="",null!=params.body&&(page.body=params.body),null!=params.overlay&&(this.parentUrl=params.parent,bgpage=baseUrl,null!=params.urlStack?overlay.urlStack=params.urlStack:overlay.urlStack.push(params.parent),overlay.show(),wrapper.enable(),location.hash&&(this.hash=location.hash,o=doc.getElementById(location.hash.substring(1)),pos=0,o&&(pos=posOffset(o).top),o=void 0,pos&&(t=doc.getElementById("overlayMain")||doc.getElementById("bookInforMain"),t.scrollTop=pos,overlay._sc())),bgpage=overlay.urlStack[0],bgpage&&page.mobile!==!0&&(params.callBack=function(){var json,key,obj;if(json=page.cache[bgpage],null!=json.isLogin&&params.isLogin!==json.isLogin&&(params.isLogin===!0?auth.logout():(page.cache={},params.isLogin=json.isLogin)),null!=json.pids&&(cart.pids=json.pids,cart.nums=json.nums||{},cart.setNum()),null!=json.parts)for(key in json.parts)doc.getElementById(key)&&(doc.getElementById(key).innerHTML=json.parts[key]);return null!=params.targetId&&(obj=doc.getElementById(params.targetId),obj&&(selectmenu.disable(),overlay.parentPos=posOffset(obj).top-100,overlay.parentPos<4&&(overlay.parentPos=0),asyncCall(function(){return win.scroll(0,overlay.parentPos),page.headerset(),page.footerset(),lazy.init(),lazy.show()}),setTimeout(function(){var s;return overlay.flag&&(s=win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0,s!==overlay.parentPos)?(win.scroll(0,overlay.parentPos),page.headerset(),page.footerset()):void 0},4e3))),doc.body.classList.contains("page-home")&&0===(win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0)?((page.mobile||overlay.flag||dialog.flag)!==!0&&doc.getElementById("searchText").focus(),page.url===baseUrl&&selectmenu.enable()):selectmenu.menu&&(asyncCall(function(){return selectmenu.menu.classList.remove("anime"),selectmenu.menu.classList.remove("pin")}),selectmenu.disable(),setTimeout(function(){return selectmenu.menu.classList.add("anime")},100)),lazy.init(),lazy.show()},this.lfData(bgpage))),doc.getElementById("bannerTopAd")&&banner.show(),null!=params.forceLogin&&params.forceLogin===!0&&setTimeout(function(){return dialog.login.open(),params.forceLogin=!1},500),null!=params.forceError&&params.forceError===!0&&setTimeout(function(){return dialog.error.open(params.error)},50),null!=params.free&&(cart.free=params.free),getWindowSize(),search.init()},headerset:function(){if(this.scrollPos=win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0,this.posCache[this.url+this.hash]=this.scrollPos,this.scrollPos>0){if(!page.hasScrolled)return header.classList.add("scrolled"),page.hasScrolled=!0}else if(page.hasScrolled)return header.classList.remove("scrolled"),page.hasScrolled=!1},footerset:function(){var navHasScrolled,s;if(s=totalHeight-windowHeight,navHasScrolled=navigation.classList.contains("scrolled"),this.scrollPos<s){if(!navHasScrolled)return navigation.classList.add("scrolled")}else if(navHasScrolled)return navigation.classList.remove("scrolled")},hashpos:function(hash){var o,pos,t;this.hash=hash,pos=0,o=doc.getElementById(hash.substring(1)),o&&(pos=o.offsetTop),overlay.flag?(t=doc.getElementById("overlayMain")||doc.getElementById("bookInforMain"),pos&&(t.scrollTop=pos,overlay._sc()),"bookInforMain"===t.id&&bookSearch.init(),t=void 0):(win.scroll(0,pos),this.headerset(),this.footerset())},popstate:function(href,hash){var spb;return this.hash="",href===page.url&&hash?void this.hashpos(hash):(dialog.flag&&dialog["break"](),wrapper.flag&&wrapper.disable(),overlay.urlStack.length&&(overlay.urlStack.pop(),page.parentUrl=""),spb=0,null!=this.posCache[href+hash]&&(spb=this.posCache[href+hash]),this.load(href,!1,!1,!1),this.scrollPos=spb,hash?this.hashpos(hash):win.scroll(0,this.scrollPos))},push:function(url){return this.load(url,!0,!0)}},null!=(null!=(ref1=win.history)?ref1.pushState:void 0)?(page.pushState=function(url){return history.pushState("","",url)},page._ps=function(){var href;return href=location.pathname+location.search,page.flag===href?page.flag="":page.popstate(href,location.hash)},page.init=function(){page.initsub(),win.addEventListener("popstate",page._ps)}):(page.pushState=function(url){return location.hash="l:"+url},page._ps=function(){var h,hash,href;return hash="",href="/dp","#l:"===location.hash.substr(0,3)?(href=location.hash.substring(3),h=href.indexOf("#"),h>-1&&(href=href.substring(0,h),hash=href.substring(h))):location.hash&&(hash=location.hash),page.popstate(href,hash)},page.init=function(){page.initsub(),win.addEventListener("hashchange",page._ps),"#l:"===location.hash.substr(0,3)&&page.load(location.hash.replace("#l:",""),!1)}),banner={tid:[],cache:{},view:null,dir:!0,reload:!0,show:function(){return this.reload=!0,this.cache.length?banner.drow(this.view||0):(api.success.getBanner=function(json){return null!=json.isLogin&&params.isLogin!==json.isLogin&&(params.isLogin===!0?auth.logout():(page.cache={},params.isLogin=json.isLogin)),null!=json.pids&&(cart.pids=json.pids,cart.nums=json.nums||{},cart.setNum()),banner.cache=json.ad,banner.drow(banner.view||0),!0},api.call("GET","getBanner",{},!0))},drow:function(num){var d,dot,i,len1,len2,m,max,obj,p,prev,ref2,ref3,ref4,t,u,z;if(this.tid.length){for(;t=this.tid.pop();)clearTimeout(t);t=void 0,this.tid=[]}if(obj=doc.getElementById("bannerTopAd")){for(max=this.cache.length-1,t=doc.createElement("div"),t.innerHTML=this.cache[num],n=first_child(t),t=void 0,obj.insertBefore(n,obj.firstChild),ref2=obj.querySelectorAll(".frame.ad"+num+" > div"),m=0,len1=ref2.length;len1>m;m++)n=ref2[m],null!=n&&(n.style.opacity=1);if(n=void 0,lazy.init(),lazy.show(),null!=this.view&&null!==this.view){for(this.dir?prev=num>0?num-1:max:(prev=max>num?num+1:0,this.dir=!0),ref3=obj.querySelectorAll(".frame.ad"+prev+" > div"),u=0,len2=ref3.length;len2>u;u++)d=ref3[u],d.setAttribute("style","");d=void 0,p=obj.querySelector(".frame.ad"+prev),setTimeout(function(){return null!=(null!=p?p.parentNode:void 0)&&p.parentNode.removeChild(p),p=void 0},250)}for(this.view=num,dot="",i=z=0,ref4=max;ref4>=0?ref4>=z:z>=ref4;i=ref4>=0?++z:--z)dot+=i===num?'<li class="current">●</li>':"<li>●</li>";return doc.getElementById("topAdNum").innerHTML=dot,num++,num>max&&(num=0),this.reload?(t=setTimeout(function(){banner.reload&&banner.drow(num)},2e4),this.tid.push(t),t=void 0):void 0}}},wrapper={flag:!1,noclick:!1,layer:0,key:null,target:null,rootbdy:doc.body,body:doc.getElementById("backgroundWrapper"),enable:function(){this.flag!==!0&&(this.noclick=params.noclick,params.noclick=!0,this.flag=!0,this.body.style.display="block",this.rootbdy.style.overflow="hidden",asyncCall(function(){return wrapper.body.style.opacity=.4}),setTimeout(function(){var d,len1,m,ref2;for(ref2=main.childNodes,m=0,len1=ref2.length;len1>m;m++)d=ref2[m],"DIV"===d.tagName&&"overlayWindow"!==d.id&&d.classList.add("blur");return d=void 0,header.classList.add("blur"),navigation.classList.add("blur"),doc.getElementById("storeInformation").classList.add("blur"),params.noclick===!0?params.noclick=wrapper.noclick:void 0},200))},disable:function(){var d,len1,m,ref2;if(this.flag&&dialog.flag===!1&&overlay.flag===!1){for(this.flag=!1,this.body.style.opacity=0,setTimeout(function(){return wrapper.body.style.display="none",wrapper.rootbdy.style.overflow="auto"},250),ref2=main.childNodes,m=0,len1=ref2.length;len1>m;m++)d=ref2[m],"DIV"===d.tagName&&d.classList.remove("blur");d=void 0,header.classList.remove("blur"),navigation.classList.remove("blur"),doc.getElementById("storeInformation").classList.remove("blur")}}},dialog={reload:!1,flag:!1,body:null,container:doc.getElementById("footer"),parentPos:0,_sc:function(e){var d,dialogHasScrolled;return e&&e.stopPropagation(),e=void 0,d=dialog.body,dialogHasScrolled=d.classList.contains("scrolled"),n=d.scrollTop,n>0?dialogHasScrolled||d.classList.add("scrolled"):dialogHasScrolled&&d.classList.remove("scrolled"),d=void 0},"break":function(){var e;if(this.flag){this.flag=!1,this.body&&(this.body.style.opacity=0);try{this.body.removeEventListener("touchmove",this._sc),this.body.removeEventListener("scroll",this._sc)}catch(_error){return void(e=_error)}setTimeout(function(){return dialog.body?dialog.body.style.display="none":void 0},130),setTimeout(function(){for(;dialog.body.firstChild;)dialog.body.removeChild(dialog.body.firstChild);return dialog.body.parentNode&&dialog.body.parentNode.removeChild(dialog.body),dialog.body=null},250)}return null!=overlay.flag&&overlay.flag===!0?(overlay.body.style.zIndex="",overlay.body.classList.remove("blur")):void 0},disable:function(){return this.flag&&(this["break"](),wrapper.disable()),this.reload?(this.reload=!1,page.reload()):void 0},enable:function(target,param){return null==param&&(param=""),this.flag&&(this.body.parentNode.removeChild(this.body),this.flag=!1),null!=overlay.flag&&overlay.flag===!0&&(overlay.body.style.zIndex=5,overlay.body.classList.add("blur")),wrapper.enable(),params.callBack=function(){var a,d;return dialog.flag?void 0:(dialog.flag=!0,page.cache[target+param].dialog?(d=doc.createElement("div"),d.innerHTML=page.cache[target+param].dialog,n=first_child(d),d=void 0,dialog.container.insertBefore(n,dialog.container.firstChild),dialog.body=doc.getElementById("dialog"),dialog.body.style.opacity=1,a=doc.createElement("a"),a.id="focusPointD",a.href="#",a.setAttribute("onclick","return false"),dialog.body.insertBefore(a,dialog.body.firstChild),a=void 0,dialog.body.addEventListener("touchmove",dialog._sc),dialog.body.addEventListener("scroll",dialog._sc),dialog.body.classList.contains("dialog-download")&&dialog.makedl(param),doc.getElementById("focusPointD").focus()):void page.reload())},page.lfData(target,"function",param)},makedl:function(code){return dialog.flag?(api.error["function"]=function(){return!1},api.success["function"]=function(json){var clsname,data,fn,len1,m,ref2;if(json.item){for(ref2=json.item,fn=function(clsname,html){var d,h,i,len2,u;for(d=dialog.body.querySelectorAll(clsname),u=0,len2=d.length;len2>u;u++)i=d[u],i.classList.contains("wait")&&(h=doc.createElement("ul"),appendHTML(h,html),i.parentNode.replaceChild(first_child(h),i),h=void 0);return i=void 0,d=void 0},m=0,len1=ref2.length;len1>m;m++)data=ref2[m],clsname=data.clsname.replace(/(^| +)([a-z0-9_-]+)/gi,".$2"),fn(clsname,data.html),"undefined"!=typeof Dropbox&&null!==Dropbox&&!function(clsname){var a,btn,d,fname,href,i,len2,len3,param,ref3,u,z;for(d=dialog.body.querySelectorAll(clsname),u=0,len2=d.length;len2>u;u++){for(i=d[u],ref3=i.querySelectorAll("a"),z=0,len3=ref3.length;len3>z&&(a=ref3[z],a.getAttribute("class"));z++);href=a.href,a=void 0,href&&(fname=decodeURIComponent(href.split("/").pop()),param={files:[{url:href,filename:fname}],error:function(mes){return console.log(mes)}},btn=Dropbox.createSaveButton(param),btn.title="Dropboxに保存する",i.appendChild(btn))}return i=void 0,d=void 0}(clsname);return"200"===json.status&&json.finish!==!0?setTimeout(function(){return dialog.makedl(json.code)},1e3):void 0}},api.call("GET","function",{url:"dlmakecheck",param:code})):void 0},login:{open:function(){return dialog.enable("login"),dialog.body.querySelector('input[type="email"]').focus()}},account:{open:function(){return dialog.enable("account")}},download:{open:function(target){var gat;return gat=target,"b"===target.charAt(0)&&(gat=target.substring(1)),ga("send","event","download","open",gat),dialog.enable("download",target)}},error:{open:function(html){var l;return null==html&&(html='<p class="title">エラーが発生しました</p><p>大変申し訳ございませんが，エラーが発生したため処理完了できませんでした。</p><p>お手数をおかけいたしますが，時間をおいて再度お試しください。</p>'),wait.hide(),l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),l=void 0,page.cache.error={dialog:'<aside id="dialog" class="dialog-error"><div id="dialogBody">'+html+'<p id="close"><a href="" title="閉じる">閉じる</a></p></div></aside>'},dialog.enable("error")}}},overlay={flag:!1,templ:null,body:null,close:null,urlStack:[],parentPos:0,_sc:function(e){var overlayHasScrolled,t;return e&&e.stopPropagation(),e=void 0,overlayHasScrolled=overlay.body.classList.contains("scrolled"),t=doc.getElementById("overlayMain")||doc.getElementById("bookInforMain"),n=t.scrollTop,t=void 0,n>0?overlayHasScrolled||overlay.body.classList.add("scrolled"):overlayHasScrolled&&overlay.body.classList.remove("scrolled"),lazy.show()},disable:function(force){var parent;return null==force&&(force=!1),this.flag?(parent=this._break(force),wrapper.disable(),page.push(parent)):void 0},"break":function(force){var parent;return null==force&&(force=!1),this.flag?(parent=this._break(force),page.push(parent)):void 0},_break:function(force){var e,parent,ref2,ref3,t;if(null==force&&(force=!1),this.flag=!1,this.body){this.body.style.opacity=0,t=doc.getElementById("overlayMain")||doc.getElementById("bookInforMain");try{t.removeEventListener("touchmove",this._sc),t.removeEventListener("scroll",this._sc)}catch(_error){return void(e=_error)}t=void 0,setTimeout(function(_this){return function(){var ref2;for(_this.body.style.display="",_this.close.style.display="";_this.body.firstChild;)_this.body.removeChild(_this.body.firstChild);return null!=(ref2=_this.body.parentNode)&&ref2.removeChild(_this.body),_this.body=null,_this.close=null}}(this),130)}return parent=page.parentUrl,this.urlStack.length?force?(parent=this.urlStack[0],this.urlStack=[]):parent=this.urlStack.pop():parent=page.parentUrl?page.parentUrl:null!=(null!=(ref2=page.cache[location.pathname])&&null!=(ref3=ref2.params)?ref3.parent:void 0)?page.cache[location.pathname].params.parent:baseUrl,parent},enable:function(target){return dialog.flag&&(dialog.body.parentNode.removeChild(dialog.body),dialog.flag=!1),page.push(target),target===baseUrl+"/cart"?delete page.cache[target]:void 0},show:function(){var overlayHasScrolled,t;return this.flag=!0,this.parentPos=win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0,this.body=doc.getElementById("overlayWindow"),this.close=doc.getElementById("close"),this.urlStack.length&&(this.close.querySelector("a").href=this.urlStack[this.urlStack.length-1],this.urlStack.length>1&&this.close.classList.add("prev")),this.body.style.display="block",t=doc.getElementById("overlayMain")||doc.getElementById("bookInforMain"),"bookInforMain"===t.id&&bookSearch.init(),overlayHasScrolled=this.body.classList.contains("scrolled"),t.scrollTop>0&&(overlayHasScrolled||this.body.classList.add("scrolled"),lazy.show()),asyncCall(function(){var a;return this.body.style.opacity=1,this.close.style.display="block",a=doc.createElement("a"),a.id="focusPoint",a.href="#",a.setAttribute("onclick","return false"),t.insertBefore(a,t.firstChild),a=void 0,doc.getElementById("focusPoint").focus(),t.addEventListener("touchmove",this._sc),t.addEventListener("scroll",this._sc),t=void 0},this)},book:{menu:null,link:null,open:function(url){return overlay.enable(url)},jump:function(obj){var biobj,h,hash,pos,url;return hash=obj.href.replace(/^.*#/,""),
obj=void 0,h=doc.getElementById(hash),biobj=doc.getElementById("bookInforMain"),"title"===hash||null===h?(pos=0,hash="#"):(pos=h.offsetTop,hash="#"+hash),location.hash=hash,biobj.scrollTop=pos,biobj=void 0,h=void 0,url=location.href.replace(/#.*$/,""),page.flag=url+hash,win.scroll(0,page.scrollPos)}}},dropmenu={flag:!1,parent:null,menu:null,body:null,wrapper:null,disable:function(){return this.flag?(this.flag=!1,this.parent.classList.remove("drop-menu"),this.wrapper.style.background="rgba(248,248,248,0)",this.body.setAttribute("style",""),setTimeout(function(_this){return function(){return _this.wrapper.setAttribute("style",""),_this.menu.setAttribute("style","")}}(this),250)):void 0},enable:function(){return this.flag?void 0:(this.flag=!0,this.parent.classList.add("drop-menu"),this.wrapper.style.display="block",this.menu.style.display="block",asyncCall(function(){return this.wrapper.style.background="rgba(248,248,248,0.7)",this.body.style.marginTop=0},this))},gift:{trigger:function(){return dropmenu.parent=doc.getElementById("overlayHeader"),dropmenu.menu=doc.getElementById("dropMenu"),dropmenu.body=doc.getElementById("dropMenuBody"),dropmenu.wrapper=doc.getElementById("dropmenuWrapper"),dropmenu.flag?dropmenu.disable():(dropmenu.enable(),doc.getElementById("giftCode").focus())}}},cart={menu:doc.getElementById("cart").querySelector("a"),pids:[],nums:{},free:!1,setNum:function(){var num;return n=doc.getElementById("itemNumber"),n&&n.parentNode.removeChild(n),num=this.pids.length||0,num?(n=mkElm("span","itemNumber"),n.textContent=num,this.menu.setAttribute("title",num+"個のアイテム"),this.menu.appendChild(n)):this.menu.setAttribute("title","カートは空です"),n=void 0},_update:function(json){null!=json.isLogin&&params.isLogin!==json.isLogin&&(params.isLogin===!0?auth.logout():params.isLogin=json.isLogin),cart.pids=json.pids||[],cart.nums=json.nums||{},page.cache={},cart.setNum(),json=void 0},refresh:function(){var data;return data={pids:this.pids,nums:this.nums},api.success.cartMerge=function(json){return cart._update(json)},page.cache={},api.call("POST","cartMerge",data)},add:function(pid){return this.pids.push(pid),"g"===pid.substring(pid.length-1)&&(this.nums[pid]?this.nums[pid]++:this.nums[pid]=1),this.setNum(),ga("send","event","cart","add",pid),this.refresh()},cntset:function(pid,num){var data;return this.nums[pid]=num,data={pids:this.pids,nums:this.nums},api.success.cartMerge=function(json){return cart._update(json),page.reload()},page.cache={},api.call("POST","cartMerge",data)},"delete":function(pid){var data,i,len1,m,ref2,stack;for(stack=[],ref2=this.pids,m=0,len1=ref2.length;len1>m;m++)i=ref2[m],i!==pid&&stack.push(i);return this.pids=stack,this.nums[pid]&&delete this.nums[pid],this.setNum(),ga("send","event","cart","delete",pid),data={pid:pid},api.success.cartDelete=function(json){return cart._update(json)},api.call("POST","cartDelete",data)},clear:function(){return ga("send","event","cart","clear","all"),api.success.cartClear=function(json){return cart._update(json),page.reload()},api.call("POST","cartClear")},gift:function(){var code;return code=doc.getElementById("giftCode").value,code?(api.success.gift=function(json){return"200"===json.status?(cart._update(json),dropmenu.disable(),overlay["break"](!0),dialog.error.open('<p class="title"></p><p>マイページに追加されました。</p>')):(dropmenu.disable(),dialog.error.open(json.error))},api.call("POST","gift",{code:code})):void 0},addmypage:function(){return api.error.addMyPage=function(){return dialog.error.open('<p class="title">マイページ追加エラー</p><p>マイページへの登録に失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>'),!1},api.success.addMyPage=function(json){return"200"===json.status?(cart.pids=json.pids||[],cart.nums=json.nums||{},page.cache={},cart.setNum(),overlay["break"](!0),dialog.error.open('<p class="title"></p><p>マイページに追加されました。</p>')):dialog.error.open(json.error)},api.call("POST","addMyPage",{pids:this.pids,nums:this.nums})},payment:{redirect:function(prov){var d,f,l,mes,name;name=cart[prov].name,api.error[prov]=function(){return dialog.error.open('<p class="title">'+name+"エラー</p><p>"+name+"の呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>"),!1},api.success[prov]=function(json){return"200"===json.status?cart[prov].url=json.redirect:dialog.error.open('<p class="title">'+name+"エラー</p><p>"+name+"の呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>")},mes='<p class="title">'+name+"へ接続しています</p>",cart.free===!0&&(mes+="<p>※無料のアイテムはマイページに追加されました</p>"),d=mkElm("div","loadingMessage"),d.innerHTML=mes,f=doc.getElementById("footer"),f.insertBefore(d,f.firstChild),d=void 0,f=void 0,wait.show(),cart[prov].url="",api.call("GET",prov),""!==cart[prov].url?(ga("send","pageview","/dp/cart/go-"+prov),d=mkElm("div","clickBlock"),main.insertBefore(d,main.firstChild),params.noclick=!0,doc.removeEventListener("click",eventhandle),location.href=cart[prov].url):(l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),l=void 0,dialog.error.open('<p class="title">'+name+"エラー</p><p>"+prov+"の呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>"))}},yahoo:{name:"FastPay",url:"",redirect:function(){return cart.payment.redirect("yahoo")}},paypal:{name:"PayPal",url:"",redirect:function(){return cart.payment.redirect("paypal")}}},subscription={url:"",dir:"",cancel:function(id){return api.success.subscCancel=function(json){var obj;return(json.status="200"&&null!=json.list)?(obj=doc.getElementById("dialogBody").querySelector(".subscription-list"),obj.innerHTML=json.list,obj=void 0,dialog.reload=!0):void 0},api.call("POST","subscCancel",{target:id})},redirect:function(){var d,f,l,lts,mes,pay,tgt,url;api.error.paypalSub=function(){return dialog.error.open('<p class="title">PayPalエラー</p><p>PayPalの呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>'),!1},api.success.paypalSub=function(json){return"200"===json.status?(subscription.url=json.redirect,subscription.dir=json.dir):dialog.error.open('<p class="title">PayPalエラー</p><p>PayPalの呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>')},mes='<p class="title">PayPalサイトへ移動しています</p>',d=mkElm("div","loadingMessage"),d.innerHTML=mes,f=doc.getElementById("footer"),f.insertBefore(d,f.firstChild),d=void 0,f=void 0,wait.show(),this.url="",tgt=doc.getElementById("subscriptionTarget").value,pay=doc.getElementById("subscriptionPayment").value,lts=doc.getElementById("subscriptionLatest").value,url=location.href.replace(/#.*$/,""),api.call("GET","paypalSub",{url:url,target:tgt,payment:pay,latest:lts}),""!==this.url?(ga("send","pageview","/dp/subscription/"+this.dir+"/go-paypal"),d=mkElm("div","clickBlock"),main.insertBefore(d,main.firstChild),d=void 0,params.noclick=!0,doc.removeEventListener("click",eventhandle),location.href=this.url):(l=doc.getElementById("loadingMessage"),l&&l.parentNode.removeChild(l),l=void 0,dialog.error.open('<p class="title">PayPalエラー</p><p>PayPalの呼び出しに失敗しました。</p><p>お手数ですが，時間をおいて再度お試しください。</p>'))}},notify={obj:{},add:function(obj){return params.isLogin?(this.obj=obj,api.success.notify=function(json){return(json.status="200")?notify.obj.classList.add("notify"):void 0},api.call("POST","notify",{action:"add",target:obj.getAttribute("data-pid")})):(dialog.login.open(),!1)},remove:function(obj){return params.isLogin?(this.obj=obj,api.success.notify=function(json){return(json.status="200")?notify.obj.classList.remove("notify"):void 0},api.call("POST","notify",{action:"remove",target:obj.getAttribute("data-pid")})):(dialog.login.open(),!1)}},ready=function(){var cnt,vp,w;return page.init(),asyncCall(function(){return selectmenu.init(),series.init(),null!=selectmenu.menu&&(selectmenu.menu.classList.add("anime"),doc.body.classList.contains("page-home")&&0===(win.pageYOffset||doc.documentElement.scrollTop||doc.body.scrollTop||0)&&(page.url===baseUrl&&selectmenu.enable(),(page.mobile||overlay.flag||dialog.flag)!==!0))?doc.getElementById("searchText").focus():void 0}),getWindowSize(),lazy.init(),lazy.show(),/Android/.test(navigator.userAgent)&&null!=win.devicePixelRatio&&(w=Math.round(screen.width/win.devicePixelRatio),vp=doc.querySelector('meta[name="viewport"]'),cnt=vp.getAttribute("content"),cnt=cnt.replace("device-width",w),vp.setAttribute("content",cnt)),/mobi/i.test(navigator.userAgent)&&(page.mobile=!0),doc.addEventListener("click",eventhandle),doc.body.addEventListener("keydown",function(e){var d,k,ref2,ref3,ref4,ref5,t,tgt;if(w=e.which,k=e.keyCode,tgt=e.target,w&&16===w||k&&16===k)params.keyshift=!0;else if(w&&27===w||k&&27===k)dropmenu.flag?dropmenu.disable():dialog.flag?dialog.disable():overlay.flag?overlay.disable(!0):(null!=(ref2=selectmenu.menu)?ref2.classList.contains("pin"):void 0)&&(doc.getElementById("searchText").focus(),selectmenu.disable());else if(w&&9===w||k&&9===k)if(params.keyshift)"selectLabel"===tgt.id?(doc.getElementById("cart").querySelector("a").focus(),e.preventDefault()):"searchText"===tgt.id&&(doc.getElementById("selectLabel").focus(),e.preventDefault());else if("cart"===(null!=(ref3=tgt.parentNode)?ref3.id:void 0))doc.getElementById("selectLabel").focus(),e.preventDefault();else if("selectLabel"!==tgt.id||selectmenu.menu.classList.contains("pin"))if("searchText"===tgt.id){if(t=doc.getElementById("pagingTop"),d=null,"none"!==(t.currentStyle||doc.defaultView.getComputedStyle(t,"")).display&&(d=t.querySelector("a,input,select")||null),null===d)for(t=node_after(doc.getElementById("topNavigation")),d=t.querySelector("a,input,select")||null;null===d&&(t=node_after(t));)d=t.querySelector("a,input,select")||null;t=void 0,d&&d.focus(),d=void 0,e.preventDefault()}else"selectMenuBody"!==(null!=(ref4=tgt.parentNode)&&null!=(ref5=ref4.parentNode)?ref5.id:void 0)||node_after(tgt.parentNode)||(selectmenu.disable(),doc.getElementById("searchText").focus(),e.preventDefault());else doc.getElementById("searchText").focus(),e.preventDefault();return tgt=void 0,e=void 0}),doc.body.addEventListener("keyup",function(e){var k,ref2,ref3,ref4,t,tgt;return w=e.which,k=e.keyCode,tgt=e.target,w&&16===w||k&&16===k?params.keyshift=!1:(w&&9===w||k&&9===k)&&(params.keyshift?"focusPoint"===tgt.id?(t=doc.getElementById("overlayHeader").querySelectorAll("a"),t[t.length-1].focus(),t=void 0):"selectMenuBody"!==(null!=(ref2=tgt.parentNode)&&null!=(ref3=ref2.parentNode)?ref3.id:void 0)||selectmenu.menu.classList.contains("pin")?"next"!==tgt.className&&"prev"!==tgt.className||null!=tgt.parentNode.parentNode.parentNode.id!=="pagingTop"||"none"===(t.currentStyle||doc.defaultView.getComputedStyle(t,"")).display&&doc.getElementById("searchText")&&doc.getElementById("searchText").focus():doc.getElementById("searchText").focus():"focusPoint"===tgt.id&&(t=tgt.parentNode.querySelectorAll("a,input,select"),null!=(ref4=t[1])&&ref4.focus(),t=void 0)),tgt=void 0,e=void 0}),doc.addEventListener("mouseup",function(e){page.click="undefined"==typeof msie||null===msie||8!==msie?e.which<=1?!0:!1:!0}),doc.addEventListener("mouseover",function(e){return"selectLabel"!==e.target.id?void(e=void 0):(e=void 0,selectmenu.menu.classList.contains("close")?setTimeout(function(){return selectmenu.menu.classList.remove("close")},250):void 0)}),doc.addEventListener("touchmove",function(e){var r;return page.ripple&&(page.ripple=null,r=doc.getElementById("rippleRipple"),r&&doc.body.removeChild(r),r=void 0),overlay.flag||dialog.flag?(e.preventDefault(),e.stopPropagation(),!1):(selectmenu.disable(),page.headerset(),page.footerset())}),doc.addEventListener("touchstart",function(e){var l,parent,ref2,t;page.click&&(null==params.noclick||params.noclick!==!0)&&page.mobile&&"A"===e.target.tagName&&(null==e.target.className||" dropbox-"!==e.target.className.substring(0,9))&&(page.ripple=e.target,parent=null!=(ref2=page.ripple.parentNode)?ref2:null,parent&&(t=e.targetTouches[0].pageY,l=e.targetTouches[0].pageX,asyncCall(function(){var r;return r=doc.createElement("div"),r.id="rippleRipple",r.classList.add("ripple"),r.setAttribute("style","top:"+(t-25)+"px;left:"+(l-25)+"px"),doc.body.appendChild(r),r=void 0,setTimeout(function(){return r=doc.getElementById("rippleRipple"),r&&doc.body.removeChild(r),r=void 0},500)})))}),doc.addEventListener("scroll",function(e){return overlay.flag||dialog.flag?(e.preventDefault(),e.stopPropagation(),!1):(selectmenu.disable(),page.headerset(),page.footerset(),lazy.show())}),win.addEventListener("resize",function(){return getWindowSize(),lazy.repos(),lazy.show()})},eventhandle=function(e){var adn,cr,dm,et,ev,grandpa,grandpaId,href,hrefurl,o,parent,parentId,pl,ref2,ref3,ref4,ref5,ref6,ref7,reg,target,w,x;if("undefined"!=typeof msie&&null!==msie&&8===msie||null==e.which||1===e.which){if(e.preventDefault(),!page.click)return!1;if(null!=params.noclick&&params.noclick===!0)return!1;if(target=e.target,"rippleRipple"===target.id&&(target=page.ripple),"backgroundWrapper"!==target.id&&"dialog"!==target.id&&"dropmenuWrapper"!==target.id&&"INPUT"!==target.nodeName){for(;null!==target&&"A"!==target.nodeName&&"NAV"!==target.nodeName&&"HEADER"!==target.nodeName;)target=null!=(ref2=target.parentNode)?ref2:null;if(null===target)return selectmenu.disable(),!1}switch(parent=null!=(ref3=target.parentNode)?ref3:null,parentId=null!=(ref4=parent.id)?ref4:null,grandpa=null!=(ref5=parent.parentNode)?ref5:null,grandpaId=null!=(ref6=grandpa.id)?ref6:null,target.id){case"backgroundWrapper":case"dialog":return dropmenu.flag?dropmenu.disable():dialog.flag?dialog.disable():overlay.flag?overlay.disable(!0):wrapper.disable(),target=void 0,parent=void 0,grandpa=void 0,!1;case"dropmenuWrapper":return dropmenu.disable(),target=void 0,parent=void 0,grandpa=void 0,!1;case"selectMenu":case"searchSubmit":case"bookSearchSubmit":return target=void 0,parent=void 0,grandpa=void 0,!1;case"selectLabel":return dm=selectmenu.menu.classList,dm.contains("pin")?(dm.remove("pin"),dm.add("close")):(dm.contains("close")&&dm.remove("close"),dm.add("pin")),dm=void 0,target=void 0,parent=void 0,grandpa=void 0,!1;case"searchText":case"bookSearchText":return target.value.length&&(x=e.pageX-posOffset(target).left,pl=target.style.paddingLeft?parseInt(target.style.paddingLeft):0,w=target.clientWidth,w+=pl,14>w-x&&(target.value="",doc.createEvent?(ev=doc.createEvent("HTMLEvents"),ev.initEvent("change",!0,!1),target.dispatchEvent(ev),ev=void 0):target.fireEvent("onchange"))),target=void 0,parent=void 0,grandpa=void 0,!1;case"header":return action.scrollTop.func(e,win),target=void 0,parent=void 0,grandpa=void 0,!1;case"overlayHeader":return target=doc.getElementById(doc.getElementById("overlayMain")?"overlayMain":"bookInforMain"),action.scrollTop.func(e,target),target=void 0,parent=void 0,grandpa=void 0,!1;case"yahooButton":return ga("send","event","payment","yahoo"),target=void 0,parent=void 0,grandpa=void 0,cart.yahoo.redirect(),!1;case"paypalButton":return ga("send","event","payment","paypal"),target=void 0,parent=void 0,grandpa=void 0,cart.paypal.redirect(),!1;case"paypalButtonSub":return ga("send","event","payment","paypalsub"),href=target.href,target=void 0,parent=void 0,grandpa=void 0,subscription.redirect(href),!1;case"giftSubmit":return cart.gift(),target=void 0,parent=void 0,grandpa=void 0,!1;case"releaseNotify":return target.classList.contains("notify")?notify.remove(target):notify.add(target),target=void 0,parent=void 0,grandpa=void 0,!1}if("A"===target.nodeName){if(" dropbox-"===target.className.substring(0,9))return ga("send","event","download","dropbox"),target=void 0,parent=void 0,void(grandpa=void 0);if("subscription-list"===grandpa.className)return subscription.cancel(parentId),target=void 0,parent=void 0,grandpa=void 0,!1;if("list-mybook"===grandpa.className)return dialog.download.open(parentId),target=void 0,parent=void 0,grandpa=void 0,!1;if("jump"===grandpaId)return overlay.book.jump(target),target=void 0,parent=void 0,grandpa=void 0,!1;if("pid"===target.id.substring(0,3))return et=e.target,et.classList.contains("option")?(et.classList.contains("touch")?(et.classList.remove("touch"),et.blur()):et.classList.add("touch"),et=void 0,target=void 0,parent=void 0,grandpa=void 0,!1):"gift"===et.className?(cart.add(target.id.substring(3)+"g"),et.setAttribute("title","カートを確認する"),et.textContent="カートを確認する",et.classList.remove("gift"),et.classList.add("go-cart"),et.parentNode.parentNode.classList.contains("touch")&&et.parentNode.parentNode.classList.remove("touch"),et=void 0,target=void 0,parent=void 0,grandpa=void 0,!1):"go-cart"===et.className?(page.push("/dp/cart"),et=void 0,target=void 0,parent=void 0,grandpa=void 0,!1):"download"===target.className&&target.getAttribute("data-isbn")?(dialog.download.open("b"+target.getAttribute("data-isbn")),target=void 0,parent=void 0,grandpa=void 0,!1):("#cartAdd"===target.hash?(cart.add(target.id.substring(3)),o=target.querySelector(".option"),target.setAttribute("title","カートを確認"),target.textContent="カートを確認",o&&target.appendChild(o),o=void 0,target.classList.add("go-cart"),target.href="/dp/cart"):page.push(target.href),target=void 0,parent=void 0,grandpa=void 0,!1);switch(selectmenu.disable(),hrefurl=target.href,hrefurl===location.href&&(hrefurl=""),reg=new RegExp("^https?://"+location.hostname+"(:[0-9]+)?"),hrefurl=hrefurl.replace(reg,""),reg=void 0,cr=!1,parentId){case"topAdPrev":return adn=banner.view,0===adn?adn=banner.cache.length-1:adn--,banner.dir=!1,banner.reload=!1,banner.drow(adn),target=void 0,parent=void 0,grandpa=void 0,!1;case"topAdNext":return adn=banner.view,adn++,adn>banner.cache.length-1&&(adn=0),banner.reload=!1,banner.drow(adn),target=void 0,parent=void 0,grandpa=void 0,!1;case"bannerTopAd":return ga("send","event","banner","top",hrefurl),hrefurl.match(/^\/dp/)&&!hrefurl.match(/^\/dp\/reader/)?page.push(hrefurl):win.open(hrefurl),target=void 0,parent=void 0,grandpa=void 0,!1;case"close":return"overlayFunction"===grandpaId?(""===hrefurl&&(hrefurl="/dp"),page.parentUrl?(page.parentUrl="",overlay.urlStack.length&&(page.parentUrl=overlay.urlStack.pop()),page.load(hrefurl,!1,!0)):page.push(hrefurl)):"dialogBody"===grandpaId&&dialog.disable(),target=void 0,parent=void 0,grandpa=void 0,!1;case"login":case"requestLogin":return dialog.login.open(),target=void 0,parent=void 0,grandpa=void 0,!1;case"logout":return auth.logout(),target=void 0,parent=void 0,grandpa=void 0,!1;case"account":return dialog.account.open(),target=void 0,parent=void 0,grandpa=void 0,!1;case"cart":cart.refresh(),cr=!0;break;case"cartCancel":return cart.clear(),target=void 0,parent=void 0,grandpa=void 0,!1;case"gift":return params.isLogin?dropmenu.gift.trigger():dialog.login.open(),target=void 0,parent=void 0,grandpa=void 0,!1}if("LI"===parent.nodeName&&cr!==!0)if("selectMenuBody"===grandpaId)w=doc.getElementById("searchText").value,w&&(hrefurl+=hrefurl.indexOf("?")>0?"&":"?",hrefurl+="query="+encodeURIComponent(w));else if("cartFunction"===grandpaId)return cart.addmypage(),target=void 0,parent=void 0,grandpa=void 0,!1;if("#cartDelete"===target.hash)cart["delete"](parentId.substring(3)),target=void 0,parent=void 0,grandpa=void 0,page.reload();else{if("#"===hrefurl.slice(-1))return target=void 0,parent=void 0,grandpa=void 0,!1;hrefurl.match(/^\/dp/)&&!hrefurl.match(/^\/dp\/reader/)?((target.pathname===baseUrl||target.pathname.match(/^\/dp\/(genre|series|information|my-page|help|cart|subscription)/))&&("next"===target.className&&(page.scrollPos=0),"prev"===target.className&&null!=page.posCache[hrefurl]&&(page.scrollPos=page.posCache[hrefurl]),(null!=(ref7=target.parentNode.id)?ref7.match(/^navLink/):void 0)&&(page.scrollPos=0),params.additionalCallBack=function(){var obj;return obj=doc.getElementById("navInfor"),overlay.flag===!1&&""!==obj.innerHTML?(obj.classList.add("visible"),setTimeout(function(){return doc.getElementById("navInfor").classList.remove("visible")},1e3)):void 0}),page.push(hrefurl)):hrefurl&&win.open(hrefurl)}return target=void 0,parent=void 0,grandpa=void 0,!1}return"INPUT"===target.nodeName&&"loginButton"===parentId?(auth.form()&&page.reload(),target=void 0,parent=void 0,grandpa=void 0,!1):"code"===target.className&&"giftcode-list"===grandpa.className?(target.select(),!1):(selectmenu.disable(),hrefurl="","A"===parent.nodeName&&(hrefurl=parent.href),"A"===grandpa.nodeName&&(hrefurl=grandpa.href),hrefurl.length&&(reg=new RegExp("^https?://"+location.hostname+"(:[0-9]+)?"),hrefurl=hrefurl.replace(reg,""),"/"===hrefurl.charAt(0)&&page.push(hrefurl)),target=void 0,parent=void 0,grandpa=void 0,!1)}},"undefined"==typeof msie||null===msie||8!==msie)win.addEventListener("DOMContentLoaded",ready,!1);else{try{doc.documentElement.doScroll("left")}catch(_error){return e=_error,void setTimeout(arguments.callee,0)}ready()}win.addEventListener("unload",function(){var o,params;for(doc.removeEventListener("click",eventhandle);o=doc.body.firstChild;)doc.body.removeChild(o);return o=void 0,page=void 0,api=void 0,auth=void 0,eventhandle=void 0,ready=void 0,params=void 0,main=void 0,header=void 0,navigation=void 0,win=void 0,doc=void 0}),is_all_ws=function(nod){return!/[^\t\n\r ]/.test(nod.data)},is_ignorable=function(nod){return 8===nod.nodeType||3===nod.nodeType&&is_all_ws(nod)},node_before=function(sib){for(;sib=sib.previousSibling;)if(!is_ignorable(sib))return sib;return null},node_after=function(sib){for(;sib=sib.nextSibling;)if(!is_ignorable(sib))return sib;return null},last_child=function(par){var res;for(res=par.lastChild;res;){if(!is_ignorable(res))return res;res=res.previousSibling}return null},first_child=function(par){var res;for(res=par.firstChild;res;){if(!is_ignorable(res))return res;res=res.nextSibling}return null},data_of=function(txt){var data;return data=txt.data,data=data.replace(/[\t\n\r ]+/g," ")," "===data.charAt(0)&&(data=data.substring(1,data.length))," "===data.charAt(data.length-1)&&(data=data.substring(0,data.length-1)),data}}).call(this);